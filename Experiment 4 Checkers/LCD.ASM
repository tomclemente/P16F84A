LIST P=16F84, F=INHX8M
INCLUDE<P16F84.INC>
__CONFIG _CP_OFF & _WDT_OFF & _XT_OSC

TEMP EQU 0CH
DAT EQU 0DH
COUNT EQU 10H
COUNT2 EQU 11H
IHAP EQU 12H

ORG 0000H
GOTO INIT
GOTO MAIN
ORG 0004H
GOTO INT_ROUTINE



INIT	BSF STATUS, RP0
		MOVLW 08H
		MOVWF TRISA
		CLRF TRISB
		MOVLW B'00000100'
		MOVWF OPTION_REG
		BSF INTCON, GIE
		BSF INTCON, T0IE
		BCF STATUS, RP0
		MOVLW 00H
		MOVWF PORTB
		MOVWF TEMP
		MOVWF DAT


		MOVLW 38H ;INITIALIZE LCD
		CALL INSTRUCTION

MAIN	BTFSS PORTA, 3
		GOTO MAIN
		MOVLW 01H
		CALL INSTRUCTION
		GOTO INITTOM	
		

INITTOM	MOVLW 80H
		CALL INSTRUCTION
		MOVLW 0FH
		CALL INSTRUCTION
		MOVLW 06H
		CALL INSTRUCTION

		MOVLW 03H
		MOVWF IHAP
		MOVLW 00H
		MOVWF DAT
		
TOM		CALL DELAYHALF
		CALL CHECKLNG
		INCF DAT, F
		MOVFW DAT
		CALL DISPLAYTOM
		CALL SDATA
		DECFSZ IHAP
		GOTO TOM

		
		CALL DELAY	
		MOVLW 01H
		CALL INSTRUCTION	
	
		MOVLW 0C0H
		CALL INSTRUCTION
		MOVLW 0FH
		CALL INSTRUCTION
		MOVLW 06H
		CALL INSTRUCTION
		
		MOVLW 04H
		MOVWF IHAP
		MOVLW 00H
		MOVWF DAT
		
MAAN	CALL DELAYHALF
		CALL CHECKLNG
		INCF DAT, F
		MOVFW DAT
		CALL DISPLAYMA
		CALL SDATA
		DECFSZ IHAP
		GOTO MAAN


		CALL DELAY
		MOVLW 01H
		CALL INSTRUCTION		
	
		MOVLW 094H
		CALL INSTRUCTION
		MOVLW 0FH
		CALL INSTRUCTION
		MOVLW 06H
		CALL INSTRUCTION
		
		MOVLW 05H
		MOVWF IHAP
		MOVLW 00H
		MOVWF DAT
		
RONAH	CALL DELAYHALF
		CALL CHECKLNG
		INCF DAT, F
		MOVFW DAT
		CALL DISPLAYRO
		CALL SDATA
		DECFSZ IHAP
		GOTO RONAH
		

		CALL DELAY
		GOTO INIT

DISPLAYTOM	
		ADDWF PCL, F
		NOP
		RETLW 'T'
		RETLW 'O'
		RETLW 'M'
		RETURN

DISPLAYMA	
		ADDWF PCL, F
		NOP
		RETLW 'M'
		RETLW 'A'
		RETLW 'A'
		RETLW 'N'
		RETURN

DISPLAYRO	
		ADDWF PCL, F
		NOP
		RETLW 'R'
		RETLW 'O'
		RETLW 'N'
		RETLW 'A'
		RETLW 'H'
		RETURN
 		
 DELAY: MOVLW D'122'
		MOVWF COUNT
 DELAY2:NOP
 		MOVLW 00H
		XORWF COUNT, W
		BTFSS STATUS, Z
		GOTO DELAY2
		RETURN


INT_ROUTINE
		BCF INTCON, T0IF
		DECF COUNT
		DECF COUNT2
		RETFIE
		
 DELAYHALF: MOVLW D'2'
			MOVWF COUNT2
 DELAYHALF2	MOVLW 00H
			XORWF COUNT2, W
			BTFSS STATUS, Z
			GOTO DELAYHALF2
			RETURN




INSTRUCTION:
		MOVWF PORTB
		MOVLW 00H
		MOVWF PORTA
		CALL DELAYHALF
		MOVLW 05H
		MOVWF PORTA
		CALL DELAYHALF
		MOVLW 00H
		MOVWF PORTA
		CALL DELAYHALF
		RETURN

SDATA:
		MOVWF PORTB
		MOVLW 02H
		MOVWF PORTA
		CALL DELAYHALF
		MOVLW 07H
		MOVWF PORTA
		CALL DELAYHALF	
		MOVLW 02H
		MOVWF PORTA
		CALL DELAYHALF
		RETURN

CHECKLNG:
		BTFSC PORTA, 3
		RETURN
		MOVLW 01H
		CALL INSTRUCTION
		GOTO MAIN
END
